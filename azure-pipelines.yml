trigger:
- master

resources:
  containers:
    - container: 'danger-android'
      image: 'meilcli/danger-android'
      
jobs:
  - job: Danger_PR
    displayName: Danger PR
    pool:
      vmImage: 'ubuntu-latest'
    container: 'danger-android'
    variables:
      JAVA_HOME: $(JAVA_HOME_8_X64)
    steps:
      - script: 'danger --dangerfile=.danger/danger-pr --danger_id=1'
        env:
          DANGER_GITHUB_API_TOKEN: $(DANGER_GITHUB_API_TOKEN)
      - task: Gradle@2
        env:
          JAVA_HOME: $(JAVA_HOME_8_X64)
        inputs:
          workingDirectory: ''
          gradleWrapperFile: 'gradlew'
          gradleOptions: '-Xmx3072m'
          publishJUnitResults: false
          tasks: ':app:lint'
      - task: Gradle@2
        inputs:
          workingDirectory: ''
          gradleWrapperFile: 'gradlew'
          gradleOptions: '-Xmx3072m'
          publishJUnitResults: false
          tasks: ':app:ktlintCheck'
      - task: Gradle@2
        inputs:
          workingDirectory: ''
          gradleWrapperFile: 'gradlew'
          gradleOptions: '-Xmx3072m'
          publishJUnitResults: false
          tasks: ':app:test'
      - script: 'danger --dangerfile=.danger/danger-app --danger_id=2 pr https://github.com/MeilCli/AzurePipelineAndroidSample/pull/1'
        condition: always()
        env:
          DANGER_GITHUB_API_TOKEN: $(DANGER_GITHUB_API_TOKEN)
